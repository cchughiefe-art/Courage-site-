<!DOCTYPE html>
<html>
<head>
    <title>Admin - Family Tree</title>
    <script>
        const pass = prompt("Enter Password:");
        if (pass !== "1234") window.location.href = "family.html";
    </script>
</head>
<body style="font-family: sans-serif; padding: 20px; background: #eee;">
    <div style="max-width: 400px; margin: auto; background: white; padding: 20px; border-radius: 10px;">
        <h3>Add Relative</h3>
        <input type="text" id="n" placeholder="Full Name" style="width:100%; padding:10px; margin-bottom:10px;">
        <input type="text" id="r" placeholder="Relation" style="width:100%; padding:10px; margin-bottom:10px;">
        <input type="file" id="p" accept="image/*" style="margin-bottom:10px;">
        <button id="btn" style="width:100%; padding:10px; background:#8d775f; color:white; border:none; cursor:pointer;">Save Member</button>
        <hr>
        <div id="list"></div>
        <p style="text-align:center;"><a href="family.html">Back to Tree</a></p>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.10.0/firebase-app.js";
        import { getFirestore, collection, addDoc, onSnapshot, query, orderBy, deleteDoc, doc } from "https://www.gstatic.com/firebasejs/12.10.0/firebase-firestore.js";

        const config = { 
            apiKey: "AIzaSyD00bj-hV8VSdJxAyCdqqpT7VWDMb9qNTQ", 
            authDomain: "family-tree-aec4a.firebaseapp.com",
            projectId: "family-tree-aec4a",
            appId: "1:956247325424:web:94690decde56983ff42035"
        };
        const db = getFirestore(initializeApp(config));

        document.getElementById('btn').onclick = async () => {
            const file = document.getElementById('p').files[0];
            const name = document.getElementById('n').value;
            if (!file || !name) return alert("Please add name and photo");

            const reader = new FileReader();
            reader.onloadend = async () => {
                try {
                    await addDoc(collection(db, "family"), {
                        name: name,
                        relation: document.getElementById('r').value,
                        photo: reader.result,
                        createdAt: new Date()
                    });
                    alert("Saved Successfully!");
                    document.getElementById('n').value = '';
                    document.getElementById('r').value = '';
                } catch (e) { alert("Save Failed: " + e.message); }
            };
            reader.readAsDataURL(file);
        };

        onSnapshot(query(collection(db, "family"), orderBy("createdAt", "asc")), (snap) => {
            const l = document.getElementById('list');
            l.innerHTML = '';
            snap.forEach((d) => {
                const div = document.createElement('div');
                div.style = "display:flex; justify-content:space-between; padding:5px; border-bottom:1px solid #ddd;";
                div.innerHTML = `<span>${d.data().name}</span><button onclick="window.del('${d.id}')" style="background:red; color:white; border:none; cursor:pointer;">X</button>`;
                l.appendChild(div);
            });
        });

        window.del = async (id) => { if(confirm("Delete?")) await deleteDoc(doc(db, "family", id)); };
    </script>
</body>
</html>

