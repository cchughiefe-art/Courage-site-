<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Family Tree</title>
<link href="https://fonts.googleapis.com/css2?family=Crimson+Text:wght@400;700&display=swap" rel="stylesheet">
<style>
  body { font-family: 'Crimson Text', serif; background: #f4f1ea; padding: 20px; }
  .tree { display: flex; flex-direction: column; align-items: center; }
  .spouse { display: flex; gap: 10px; position: relative; }
  .person { border: 1px solid #333; border-radius: 5px; padding: 10px 15px; min-width: 80px; text-align: center; background: #fff; position: relative; }
  
  .children { display: flex; justify-content: center; position: relative; margin-top: 20px; }
  
  /* Vertical line from parent to children */
  .line-down { position: absolute; width: 2px; background: #333; top: 100%; }
  /* Horizontal line connecting children */
  .line-horizontal { position: absolute; height: 2px; background: #333; top: 0; left: 0; right: 0; }
</style>
</head>
<body>

<h2>Family Tree</h2>
<div class="tree" id="familyTree"></div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-app.js";
import { getFirestore, collection, onSnapshot } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-firestore.js";

// Firebase setup
const app = initializeApp({
  apiKey: "AIzaSyD00bj-hV8VSdJxAyCdqqpT7VWDMb9qNTQ",
  projectId: "family-tree-aec4a"
});
const db = getFirestore(app);

let people = [];

// Get children of a person
function getChildren(parentId) {
  return people.filter(p => p.motherId === parentId || p.fatherId === parentId);
}

// Create tree recursively
function createPersonTree(person) {
  const container = document.createElement('div');
  container.style.display = 'flex';
  container.style.flexDirection = 'column';
  container.style.alignItems = 'center';
  container.style.position = 'relative';

  // Person + spouse
  const spouseDiv = document.createElement('div');
  spouseDiv.className = 'spouse';
  const selfDiv = document.createElement('div');
  selfDiv.className = 'person';
  selfDiv.textContent = person.name || '—';
  spouseDiv.appendChild(selfDiv);

  if (person.spouseId) {
    const spouse = people.find(x => x.id === person.spouseId);
    if (spouse) {
      const sDiv = document.createElement('div');
      sDiv.className = 'person';
      sDiv.textContent = spouse.name || '—';
      spouseDiv.appendChild(sDiv);
    }
  }
  container.appendChild(spouseDiv);

  // Children
  const children = getChildren(person.id);
  if (children.length) {
    // Vertical line from parents to horizontal connector
    const lineDown = document.createElement('div');
    lineDown.className = 'line-down';
    lineDown.style.height = '20px';
    lineDown.style.left = '50%';
    spouseDiv.appendChild(lineDown);

    const childrenContainer = document.createElement('div');
    childrenContainer.className = 'children';

    // Horizontal line connecting all children
    const hLine = document.createElement('div');
    hLine.className = 'line-horizontal';
    hLine.style.width = `${children.length * 100}px`;
    hLine.style.height = '2px';
    hLine.style.top = '0';
    childrenContainer.appendChild(hLine);

    children.forEach(child => {
      const childTree = createPersonTree(child);
      childTree.style.margin = '0 20px';
      childrenContainer.appendChild(childTree);
    });

    container.appendChild(childrenContainer);
  }

  return container;
}

// Build full tree from roots (no parents)
function buildTree() {
  const tree = document.getElementById('familyTree');
  tree.innerHTML = '';
  const roots = people.filter(p => !p.motherId && !p.fatherId);
  roots.forEach(root => tree.appendChild(createPersonTree(root)));
}

// Firebase real-time updates
onSnapshot(collection(db, "family"), snap => {
  people = snap.docs.map(d => ({ id: d.id, ...d.data() }));
  buildTree();
});
</script>
</body>
</html>
